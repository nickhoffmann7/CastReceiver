<!DOCTYPE html>
<html lang="en">

<head>
    <script type="text/javascript"
            src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js">
    </script>

    <style>
        cast-media-player {
            --progress-color: rgb(120, 0, 46);
            --splash-image: url('loader.svg');
        }
    </style>
</head>

<body>

<cast-media-player></cast-media-player>

<script>
    const context = cast.framework.CastReceiverContext.getInstance();

    const playerManager = context.getPlayerManager();

    playerManager.setMessageInterceptor(
        cast.framework.messages.MessageType.LOAD,
        request => {
            let metadata = request.media.metadata;
            console.log("LOAD TITLE: " + metadata.title);
            console.log("VERSION 5");
            if (metadata.content != null) {  
                request.media.contentId = "https://raw.githubusercontent.com/nickhoffmann7/CastReceiver/master/playlist.m3u8";
                console.log("LOAD CONTENTID: " + request.media.contentId);
            }
            
            return request;
        });

    context.start({playbackConfig: getPlaybackConfig()});
    //context.start();

    function getPlaybackConfig() {
        const playbackConfig = new cast.framework.PlaybackConfig();
        //playbackConfig.autoPauseDuration = 2;
        //playbackConfig.autoResumeDuration = 2;
        playbackConfig.autoResumeNumberOfSegments = 1;
        playbackConfig.segmentRequestRetryLimit = 0;
        return playbackConfig;
    }
</script>

</body>

</html>
