<!DOCTYPE html>
<html lang="en">

<head>
    <script type="text/javascript"
            src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js">
    </script>

    <style>
        cast-media-player {
            --progress-color: rgb(120, 0, 46);
            --splash-image: url('loader.svg');
        }
    </style>
</head>

<body>

<cast-media-player></cast-media-player>

<script>
    const context = cast.framework.CastReceiverContext.getInstance();

    const playerManager = context.getPlayerManager();

    playerManager.setMessageInterceptor(
        cast.framework.messages.MessageType.LOAD,
        request => { /* cast.framework.messages.LoadRequestData */
            let metadata = request.media.metadata;
            console.log(metadata.TITLE);
            console.log(metadata.CONTENT);
            if (metadata.CONTENT != null) {
                request.media.contentId = createTextFile(metadata.CONTENT);
            }
            return request;
        });

    //context.start({playbackConfig: getPlaybackConfig()});
    context.start();

    function getPlaybackConfig() {
        const playbackConfig = new cast.framework.PlaybackConfig();
        playbackConfig.autoResumeDuration = 10;
        playbackConfig.autoResumeNumberOfSegments = 10;
        return playbackConfig;
    }

    let textFile = null;

    function createTextFile(text) {
        var data = new Blob([text], {type: 'text/plain'});
        if (textFile !== null) {
            window.URL.revokeObjectURL(textFile);
        }
        textFile = window.URL.createObjectURL(data);
        return textFile;
    };
</script>

</body>

</html>
