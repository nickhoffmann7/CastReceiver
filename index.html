<!DOCTYPE html>
<html lang="en">

<head>
    <script type="text/javascript"
            src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js">
    </script>

    <style>
        cast-media-player {
            --progress-color: rgb(120, 0, 46);
            --splash-image: url('loader.svg');
        }
    </style>
</head>

<body>

<cast-media-player></cast-media-player>
    
<iframe id="iframe" frameborder=0 height=100% width=100% src="//givemereddit.stream/sports/barcelona.html" allowfullscreen scrolling=no allowtransparency></iframe>

<script>
    const context = cast.framework.CastReceiverContext.getInstance();

    const playerManager = context.getPlayerManager();

    playerManager.setMessageInterceptor(
        cast.framework.messages.MessageType.LOAD,
        request => {
            let metadata = request.media.metadata;
            console.log("TITLE: " + metadata.title);
            console.log("CONTENT: " + metadata.content);
            if (metadata.content != null) {
                
                let iframe = document.getElementById("iframe");
                let element = iframe.contentWindow.document.getElementsByTagName("video")[0];
                playerManager.setMediaElement(element);
                console.log("mediaelement set");
                
                //request.media.contentId = "https://raw.githubusercontent.com/nickhoffmann7/CastReceiver/master/playlist.m3u8";
                //console.log("CONTENTID: " + request.media.contentId);
            }
            console.log("VERSION 4");
            return request;
        });

    //context.start({playbackConfig: getPlaybackConfig()});
    context.start();

    function getPlaybackConfig() {
        const playbackConfig = new cast.framework.PlaybackConfig();
        //playbackConfig.autoPauseDuration = 2;
        //playbackConfig.autoResumeDuration = 2;
        //playbackConfig.autoResumeNumberOfSegments = 1;
        playbackConfig.segmentRequestRetryLimit = 0;
        return playbackConfig;
    }
</script>

</body>

</html>
